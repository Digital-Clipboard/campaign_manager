# Campaign Lifecycle Workflow Diagrams

## Document Information
- **Version**: 1.0
- **Date**: October 1, 2025
- **Status**: ✅ Complete
- **Purpose**: Visual workflow diagrams for automated campaign lifecycle

---

## Complete Campaign Lifecycle Flow

```
                        ┌─────────────────────┐
                        │ Campaign Created    │
                        └──────────┬──────────┘
                                   │
                        ┌──────────▼──────────┐
                        │ Split into 3 Batches│
                        └─┬────────┬─────────┬┘
                          │        │         │
        ┌─────────────────┘        │         └─────────────────┐
        │                          │                           │
┌───────▼────────┐      ┌──────────▼──────────┐      ┌────────▼───────┐
│ Round 1        │      │ Round 2             │      │ Round 3        │
│ Scheduled      │      │ Scheduled           │      │ Scheduled      │
└───────┬────────┘      └──────────┬──────────┘      └────────┬───────┘
        │                          │                           │
┌───────▼────────┐      ┌──────────▼──────────┐      ┌────────▼───────┐
│ Pre-Launch     │      │ Pre-Launch          │      │ Pre-Launch     │
│ T-21h          │      │ T-21h               │      │ T-21h          │
└───────┬────────┘      └──────────┬──────────┘      └────────┬───────┘
        │                          │                           │
┌───────▼────────┐      ┌──────────▼──────────┐      ┌────────▼───────┐
│ Pre-Flight     │      │ Pre-Flight          │      │ Pre-Flight     │
│ T-3.25h        │      │ T-3.25h             │      │ T-3.25h        │
└───────┬────────┘      └──────────┬──────────┘      └────────┬───────┘
        │                          │                           │
┌───────▼────────┐      ┌──────────▼──────────┐      ┌────────▼───────┐
│ Launch Warning │      │ Launch Warning      │      │ Launch Warning │
│ T-15min        │      │ T-15min             │      │ T-15min        │
└───────┬────────┘      └──────────┬──────────┘      └────────┬───────┘
        │                          │                           │
┌───────▼────────┐      ┌──────────▼──────────┐      ┌────────▼───────┐
│ LAUNCH         │      │ LAUNCH              │      │ LAUNCH         │
│ Round 1        │      │ Round 2             │      │ Round 3        │
└───────┬────────┘      └──────────┬──────────┘      └────────┬───────┘
        │                          │                           │
┌───────▼────────┐      ┌──────────▼──────────┐      ┌────────▼───────┐
│ Launch         │      │ Launch              │      │ Launch         │
│ Confirmation   │      │ Confirmation        │      │ Confirmation   │
└───────┬────────┘      └──────────┬──────────┘      └────────┬───────┘
        │                          │                           │
┌───────▼────────┐      ┌──────────▼──────────┐      ┌────────▼───────┐
│ Wrap-Up        │      │ Wrap-Up             │      │ Wrap-Up        │
│ T+30min        │      │ T+30min             │      │ T+30min        │
└───────┬────────┘      └──────────┬──────────┘      └────────┬───────┘
        │                          │                           │
┌───────▼────────┐      ┌──────────▼──────────┐              │
│ More Rounds?   │      │ More Rounds?        │              │
└───┬────────┬───┘      └───┬────────┬────────┘              │
    │ Yes    │              │ Yes    │                        │
    │        │              │        │                        │
    │        │              └────────┘                        │
    │        │                                                │
    └────────┼────────────────────────────────────────────────┘
             │
     ┌───────▼────────┐
     │ Campaign       │
     │ Complete       │
     └────────────────┘
```

---

## Single Round Lifecycle Detail

```
Scheduler    System      MailJet    Gemini AI    Slack      Database
    │            │           │           │           │           │
    │ T-21 hours (3 PM UTC day before)  │           │           │
    ├───────────>│           │           │           │           │
    │ Trigger    │           │           │           │           │
    │ Pre-Launch │           │           │           │           │
    │            ├──────────>│           │           │           │
    │            │Get Draft  │           │           │           │
    │            ├──────────>│           │           │           │
    │            │Get List   │           │           │           │
    │            │<──────────┤           │           │           │
    │            │Campaign & │           │           │           │
    │            │List Data  │           │           │           │
    │            ├───────────────────────>│           │           │
    │            │Generate Assessment     │           │           │
    │            │<───────────────────────┤           │           │
    │            │AI Preview & Recommend  │           │           │
    │            ├───────────────────────────────────>│           │
    │            │Post Pre-Launch         │           │           │
    │            ├───────────────────────────────────────────────>│
    │            │Mark Pre-Launch Sent    │           │           │
    │            │           │           │           │           │
    │ T-3.25 hours (6 AM UTC launch day) │           │           │
    ├───────────>│           │           │           │           │
    │ Trigger    │           │           │           │           │
    │ Pre-Flight │           │           │           │           │
    │            ├──────────>│           │           │           │
    │            │Verify List│           │           │           │
    │            ├──────────>│           │           │           │
    │            │Verify Camp│           │           │           │
    │            ├──────────>│           │           │           │
    │            │Verify Tech│           │           │           │
    │            │<──────────┤           │           │           │
    │            │Verification Results   │           │           │
    │            ├───────────────────────>│           │           │
    │            │Assess Readiness        │           │           │
    │            │<───────────────────────┤           │           │
    │            │Readiness Assessment    │           │           │
    │            ├───────────────────────────────────>│           │
    │            │Post Pre-Flight Results │           │           │
    │            ├───────────────────────────────────────────────>│
    │            │Mark Pre-Flight Sent    │           │           │
    │            │           │           │           │           │
    │ T-15 minutes (9:00 AM UTC)         │           │           │
    ├───────────>│           │           │           │           │
    │ Trigger    │           │           │           │           │
    │ Warning    │           │           │           │           │
    │            ├───────────────────────────────────>│           │
    │            │Post 15-Min Warning     │           │           │
    │            ├───────────────────────────────────────────────>│
    │            │Mark Launch Warning Sent│           │           │
    │            │           │           │           │           │
    │ T+0 (9:15 AM UTC - Manual Trigger) │           │           │
    │            ├──────────>│           │           │           │
    │            │Send Camp  │           │           │           │
    │            │<──────────┤           │           │           │
    │            │Campaign ID│           │           │           │
    │            ├───────────────────────────────────>│           │
    │            │Post Launch Confirmation│           │           │
    │            ├───────────────────────────────────────────────>│
    │            │Update Campaign ID      │           │           │
    │            │           │           │           │           │
    │ T+30 minutes (9:45 AM UTC)         │           │           │
    ├───────────>│           │           │           │           │
    │ Trigger    │           │           │           │           │
    │ Wrap-Up    │           │           │           │           │
    │            ├──────────>│           │           │           │
    │            │Get Stats  │           │           │           │
    │            │<──────────┤           │           │           │
    │            │Full Metrics           │           │           │
    │            ├───────────────────────────────────────────────>│
    │            │Get Previous Round Data │           │           │
    │            │<───────────────────────────────────────────────┤
    │            │Previous Round Metrics  │           │           │
    │            ├───────────────────────>│           │           │
    │            │Analyze Performance     │           │           │
    │            │<───────────────────────┤           │           │
    │            │AI Assessment & Recs    │           │           │
    │            ├───────────────────────────────────>│           │
    │            │Post Wrap-Up Report     │           │           │
    │            ├───────────────────────────────────────────────>│
    │            │Mark Wrap-Up Complete   │           │           │
```

---

## Pre-Flight Check Workflow

```
                    ┌──────────────────────────┐
                    │ Pre-Flight Check         │
                    │ Triggered                │
                    └────────────┬─────────────┘
                                 │
                    ┌────────────▼─────────────┐
                    │ Check List Verification  │
                    └────────────┬─────────────┘
                                 │
                          ┌──────▼──────┐
                          │List Exists? │
                          └──┬───────┬──┘
                  No         │       │        Yes
              ┌──────────────┘       └───────────┐
              │                                   │
    ┌─────────▼─────────┐              ┌─────────▼─────────┐
    │ ❌ List Check FAIL│              │ Count Matches?    │
    └─────────┬─────────┘              └──┬─────────────┬──┘
              │                     No     │             │ Yes
              │              ┌─────────────┘             │
              │              │                           │
              │   ┌──────────▼────────────┐   ┌─────────▼─────────┐
              │   │ ⚠️  List Check WARNING│   │ ✅ List Check PASS│
              │   └──────────┬────────────┘   └─────────┬─────────┘
              │              │                           │
              └──────────────┼───────────────────────────┘
                             │
                ┌────────────▼─────────────┐
                │ Check Campaign Setup     │
                └────────────┬─────────────┘
                             │
                      ┌──────▼──────┐
                      │Draft Exists?│
                      └──┬───────┬──┘
              No         │       │        Yes
          ┌──────────────┘       └───────────┐
          │                                   │
          │                          ┌────────▼─────────┐
          │                          │Content Loaded?   │
          │                          └───┬──────────┬───┘
          │                       No     │          │ Yes
          │                   ┌──────────┘          │
          │                   │              ┌──────▼─────────┐
          │                   │              │Subject Set?    │
          │                   │              └───┬────────┬───┘
          │                   │           No     │        │ Yes
          │                   │       ┌──────────┘        │
          │                   │       │            ┌──────▼────────┐
          │                   │       │            │Sender Config? │
          │                   │       │            └───┬────────┬──┘
          │                   │       │         No     │        │ Yes
          │                   │       │     ┌──────────┘        │
    ┌─────▼──────────────┐    │       │     │            ┌──────▼──────────┐
    │ ❌ Campaign Check  │◄───┴───────┴─────┴────────────┤ ✅ Campaign     │
    │ FAIL               │                                │ Check PASS      │
    └─────┬──────────────┘                                └──────┬──────────┘
          │                                                      │
          └──────────────┬───────────────────────────────────────┘
                         │
            ┌────────────▼─────────────┐
            │ Check Technical          │
            │ Validation               │
            └────────────┬─────────────┘
                         │
                  ┌──────▼──────┐
                  │Links Valid? │
                  └──┬───────┬──┘
          No         │       │        Yes
      ┌──────────────┘       └───────────┐
      │                                   │
      │                          ┌────────▼─────────┐
      │                          │Unsubscribe Link? │
      │                          └───┬──────────┬───┘
      │                       No     │          │ Yes
      │                   ┌──────────┘          │
      │                   │              ┌──────▼─────────┐
      │                   │              │Tracking Config?│
      │                   │              └───┬────────┬───┘
      │                   │           No     │        │ Yes
      │                   │       ┌──────────┘        │
      │                   │       │            ┌──────▼────────┐
      │                   │       │            │SPF/DKIM Valid?│
      │                   │       │            └───┬────────┬──┘
      │                   │       │        Issues  │        │ Valid
      │                   │       │     ┌──────────┘        │
┌─────▼──────────────┐    │       │     │            ┌──────▼──────────┐
│ ❌ Technical FAIL  │◄───┴───────┴─────┘            │ ✅ Technical    │
└─────┬──────────────┘                               │ PASS            │
      │                  ┌──────────────────┐        └──────┬──────────┘
      │                  │ ⚠️  Technical    │               │
      │                  │ WARNING          │◄──────────────┘
      │                  └─────────┬────────┘
      │                            │
      └────────────┬───────────────┘
                   │
      ┌────────────▼─────────────┐
      │ Generate AI Assessment   │
      └────────────┬─────────────┘
                   │
      ┌────────────▼─────────────┐
      │ Determine Overall Status │
      └──┬──────────┬─────────┬──┘
         │          │         │
┌────────▼─────┐  ┌▼─────────▼──┐  ┌─▼──────────┐
│ 🟢 READY FOR │  │ 🟡 NEEDS    │  │ 🔴 BLOCKED │
│ LAUNCH       │  │ ATTENTION   │  │            │
└────────┬─────┘  └┬────────────┘  └─┬──────────┘
         │         │                  │
         └─────────┼──────────────────┘
                   │
      ┌────────────▼─────────────┐
      │ Send Slack Notification  │
      └────────────┬─────────────┘
                   │
      ┌────────────▼─────────────┐
      │ Update Database          │
      └────────────┬─────────────┘
                   │
      ┌────────────▼─────────────┐
      │ Pre-Flight Complete      │
      └──────────────────────────┘
```

---

## AI Assessment Flow

```
┌─────────────────┐
│Campaign Metrics │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Collect Data   │
└───┬─────┬────┬──┘
    │     │    │
    ▼     ▼    ▼
┌────────┐┌──────────┐┌─────────────────┐
│Delivery││Engagement││Previous Round   │
│Metrics ││Metrics   ││Data             │
└───┬────┘└────┬─────┘└────────┬────────┘
    │          │                │
    └────┬─────┴────────┬───────┘
         │              │
    ┌────▼─────────┐    │    ┌──────────────────┐
    │List Quality  │◄───┘    │Delivery Analysis │
    │Agent         │         │Agent             │◄─┐
    └─┬───────────┬┘         └─┬──────────────┬─┘ │
      │           │            │              │   │
      │           │            │              │   │
      │    ┌──────┼────────────┼──────────────┘   │
      │    │      │            │                  │
      │    │      └─────┬──────┘                  │
      │    │            │                         │
      │    │      ┌─────▼──────────┐              │
      │    │      │  Comparison    │◄─────────────┘
      │    │      │  Agent         │
      │    │      └─┬──────────┬───┘
      │    │        │          │
      ▼    ▼        ▼          ▼
┌─────────┐┌────────┐┌──────────┐┌──────────┐
│Bounce   ││List    ││Delivery  ││ISP       │
│Rate     ││Health  ││Perform.  ││Insights  │
│Analysis ││Score   │└────┬─────┘└────┬─────┘
└────┬────┘└────┬───┘     │           │
     │          │          │           │
     │          │    ┌─────▼───────────▼───┐
     │          │    │Round-to-Round       │
     │          │    │Comparison           │
     │          │    └──────┬──────────────┘
     │          │           │
     │          │    ┌──────▼──────────────┐
     │          │    │Trend Analysis       │
     │          │    └──────┬──────────────┘
     │          │           │
     └──────────┴───────────┴────┐
                                 │
                      ┌──────────▼───────────┐
                      │ Recommendation Agent │
                      └──┬─────────┬────────┬┘
                         │         │        │
                    ┌────▼──┐ ┌────▼────┐ ┌▼────────┐
                    │Action │ │Predict. │ │Risk     │
                    │Items  │ └─────────┘ │Factors  │
                    └───────┘             └─────────┘
                         │         │            │
       ┌─────────────────┴─────────┴────────────┴─────────┐
       │                                                   │
       │                                                   │
┌──────▼──────────┐                                       │
│List Quality     │                                       │
│Agent            │                                       │
└──────┬──────────┘                                       │
       │                                                  │
┌──────▼──────────┐                                       │
│Delivery Analysis│                                       │
│Agent            │                                       │
└──────┬──────────┘                                       │
       │                                                  │
┌──────▼──────────┐                                       │
│Comparison Agent │                                       │
└──────┬──────────┘                                       │
       │                                                  │
┌──────▼──────────┐                                       │
│Recommendation   │◄──────────────────────────────────────┘
│Agent            │
└──────┬──────────┘
       │
       ▼
┌──────────────────┐
│Report Formatting │
│Agent             │
└──────┬───────────┘
       │
       ▼
┌──────────────────┐
│Formatted Slack   │
│Report            │
└──────────────────┘
```

---

## Batch Scheduling Algorithm

```
        ┌──────────────────┐
        │ Campaign Created │
        └────────┬─────────┘
                 │
        ┌────────▼─────────────────────────┐
        │ Input: Total Recipients,         │
        │        Start Date                │
        └────────┬─────────────────────────┘
                 │
        ┌────────▼─────────────────────────┐
        │ Calculate Batch Size             │
        │ Math.ceil(total / 3)             │
        └────────┬─────────────────────────┘
                 │
        ┌────────▼─────────────────────────┐
        │ Round 1 Setup                    │
        └────────┬─────────────────────────┘
                 │
        ┌────────▼─────────────────────────┐
        │ Recipients: 1 to batchSize       │
        └────────┬─────────────────────────┘
                 │
        ┌────────▼─────────────────────────┐
        │ Date: Start Date                 │
        └────────┬─────────────────────────┘
                 │
             ┌───▼───────────────────┐
             │ Start Date is         │
             │ Tuesday/Thursday?     │
             └───┬──────────────┬────┘
                 │ No           │ Yes
        ┌────────▼─────────┐    │
        │ Find Next        │    │
        │ Tue/Thu          │    │
        └────────┬─────────┘    │
                 │              │
                 └──────┬───────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Schedule Round 1                 │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Round 2 Setup                    │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Recipients: batchSize+1          │
        │             to 2*batchSize       │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Date: Next Tue/Thu after R1      │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Schedule Round 2                 │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Round 3 Setup                    │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Recipients: 2*batchSize+1        │
        │             to total             │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Date: Next Tue/Thu after R2      │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Schedule Round 3                 │
        └───────────────┬──────────────────┘
                        │
        ┌───────────────▼──────────────────┐
        │ Create MailJet Lists             │
        └──┬──────────┬──────────┬─────────┘
           │          │          │
    ┌──────▼──────┐ ┌▼──────────▼┐ ┌──────▼─────────┐
    │Create List 1│ │Create List 2│ │Create List 3   │
    │campaign_    │ │campaign_    │ │campaign_       │
    │batch_001    │ │batch_002    │ │batch_003       │
    └──────┬──────┘ └┬────────────┘ └──────┬─────────┘
           │         │                     │
           └─────────┼─────────────────────┘
                     │
        ┌────────────▼─────────────────────┐
        │ Create Campaign Drafts           │
        └────────────┬─────────────────────┘
                     │
        ┌────────────▼─────────────────────┐
        │ Schedule Lifecycle Notifications │
        └────────────┬─────────────────────┘
                     │
        ┌────────────▼─────────────────────┐
        │ Campaign Schedule Complete       │
        └──────────────────────────────────┘
```

---

## Data Flow Architecture

```
┌────────────────────────────────────────────────────────────────────┐
│                        EXTERNAL SERVICES                           │
├────────────────────┬──────────────────────┬────────────────────────┤
│   MailJet API      │   Slack via MCP      │   Google Gemini AI     │
└──────▲─────────────┴───────▲──────────────┴──────▲─────────────────┘
       │                     │                     │
       │                     │                     │
┌──────┴─────────────────────┴─────────────────────┴─────────────────┐
│                        CRON SCHEDULERS                              │
├─────────────────────┬──────────────────┬──────────────┬────────────┤
│ Pre-Launch Sched.   │ Pre-Flight Sched.│ Warning Sched│ Wrap-Up    │
│ 15:00 UTC T-1 day   │ 06:00 UTC T day  │ 09:00 UTC    │ Scheduler  │
│                     │                  │ T day        │ 09:45 UTC  │
└──┬────────┬─────┬───┴──────────────────┴──────────────┴────┬───────┘
   │        │     │                                           │
   │        │     │                                           │
   ▼        ▼     ▼                                           ▼
┌────────────────────────────────────────────────────────────────────┐
│                         CORE SERVICES                              │
├────────────────┬──────────────────┬──────────────┬─────────────────┤
│ Campaign       │ Notification     │ Metrics      │ AI Analysis     │
│ Service        │ Service          │ Service      │ Service         │
└────┬───────────┴─────┬────────────┴──────┬───────┴─────────┬───────┘
     │                 │                   │                 │
     │                 │                   │                 │
     │  ┌──────────────┘                   │                 │
     │  │  ┌───────────────────────────────┘                 │
     │  │  │  ┌────────────────────────────────────────────────┘
     │  │  │  │
     ▼  ▼  ▼  ▼
┌────────────────────────────────────────────────────────────────────┐
│                    PostgreSQL + Prisma DATABASE                    │
├──────────────────────┬─────────────────────┬───────────────────────┤
│  Campaign Schedule   │  Campaign Metrics   │  Notification Log     │
└──────────────────────┴─────────────────────┴───────────────────────┘


Data Flow Connections:

  Schedulers → Services:
    PreLaunchSched ──────────> NotifService
    PreFlightSched ──────────> NotifService
    WarningSched ────────────> NotifService
    WrapupSched ─────────────> MetricsService

  Services → External:
    CampService ─────────────> MailJet
    NotifService ────────────> Slack
    NotifService ────────────> AIService ───────> Gemini
    MetricsService ──────────> MailJet
    MetricsService ──────────> AIService ───────> Gemini
    MetricsService ──────────> Slack

  Services → Database:
    CampService ─────────────> CampSchedule
    NotifService ────────────> NotifLog
    MetricsService ──────────> CampMetrics

  Inter-Service:
    NotifService ────────────> CampService
```

---

## State Machine Diagram

```
                      ┌─────────────────────┐
                      │ [START]             │
                      └──────────┬──────────┘
                                 │ Campaign Scheduled
                      ┌──────────▼──────────┐
                      │ Created             │
                      └──────────┬──────────┘
                                 │ Schedule Set
                      ┌──────────▼──────────┐
                      │ PreLaunchPending    │
                      └──────────┬──────────┘
                                 │ T-21 hours
                      ┌──────────▼──────────┐
                      │ PreLaunchSent       │
                      └──────────┬──────────┘
                                 │ Wait
                      ┌──────────▼──────────┐
                      │ PreFlightPending    │
                      └──┬──────────┬────┬──┘
                         │          │    │
          All Checks Pass│          │    │Critical Failure
                         │          │    │
           ┌─────────────┘          │    └─────────────┐
           │                        │Some Warnings     │
           │                        │                  │
  ┌────────▼────────┐    ┌──────────▼──────────┐  ┌───▼──────────┐
  │ PreFlightPass   │    │ PreFlightWarning    │  │ Blocked      │
  │                 │    │                     │  │              │
  │ • List verified │    │                     │  └───┬──────────┘
  │ • Campaign      │    │                     │      │ Fix Issues
  │   configured    │    │                     │      │
  │ • Technical     │    │                     │  ┌───▼──────────┐
  │   checks passed │    │                     │  │ Manual       │
  └────────┬────────┘    └──────────┬──────────┘  │ Intervention │
           │ Wait                   │Proceed with  └───┬──────────┘
           │                        │Caution           │ Retry
           └────────────┬───────────┘                  │
                        │                              │
           ┌────────────▼──────────┐                   │
           │ LaunchWarningPending  │◄──────────────────┘
           └────────────┬──────────┘
                        │ T-15 minutes
           ┌────────────▼──────────┐
           │ LaunchWarningSent     │
           └────────────┬──────────┘
                        │ Wait
           ┌────────────▼──────────┐
           │ ReadyForLaunch        │
           └────────────┬──────────┘
                        │ Manual Trigger
           ┌────────────▼──────────┐
           │ Launching             │
           └────────────┬──────────┘
                        │ Campaign Sent
           ┌────────────▼──────────┐
           │ LaunchConfirmed       │
           │                       │
           │ • Initial metrics     │
           │   collected           │
           │ • Campaign ID         │
           │   recorded            │
           └────────────┬──────────┘
                        │ Wait 30 minutes
           ┌────────────▼──────────┐
           │ WrapUpPending         │
           └────────────┬──────────┘
                        │ Metrics Collected
           ┌────────────▼──────────┐
           │ WrapUpComplete        │
           │                       │
           │ • Full metrics        │
           │   analyzed            │
           │ • AI assessment       │
           │   generated           │
           │ • Report sent to      │
           │   Slack               │
           └────────────┬──────────┘
                        │ All Done
           ┌────────────▼──────────┐
           │ Completed             │
           └────────────┬──────────┘
                        │
           ┌────────────▼──────────┐
           │ [END]                 │
           └───────────────────────┘
```

---

## Error Handling Flow

```
                     ┌──────────────────┐
                     │ Error Detected   │
                     └────────┬─────────┘
                              │
                     ┌────────▼─────────┐
                     │ Error Type?      │
                     └┬────┬─────┬────┬─┘
                      │    │     │    │
         API Failure  │    │     │    │  Config Issue
                      │    │     │    │
          ┌───────────┘    │     │    └──────────┐
          │                │     │               │
          │   Network      │     │  Data         │
          │   Issue        │     │  Issue        │
          │                │     │               │
   ┌──────▼──────┐  ┌──────▼─────▼──┐  ┌────────▼────────┐
   │ API Error   │  │ Network Error │  │ Data Error      │
   └──────┬──────┘  └──────┬────────┘  └────────┬────────┘
          │                │                     │
          └────────────────┘                     │
                   │                             │
            ┌──────▼──────┐              ┌───────▼────────┐
            │ Retry?      │              │ Cached Data    │
            └──┬────────┬──┘              │ Available?     │
               │        │                 └───┬────────┬───┘
   Attempt < 3 │        │ Attempt >= 3        │ Yes    │ No
               │        │                     │        │
     ┌─────────▼──┐     │            ┌────────▼───┐  ┌─▼────────────┐
     │ Wait 5 min │     │            │Use Cached  │  │Skip Optional │
     └─────────┬──┘     │            │Data        │  │Step          │
               │        │            └────────┬───┘  └─┬────────────┘
     ┌─────────▼──┐     │                     │        │
     │Retry Op.   │     │                     │        │
     └─────────┬──┘     │                     │        │
               │        │                     │        │
          ┌────▼───┐    │                     │        │
          │Success?│    │                     │        │
          └──┬───┬─┘    │                     │        │
             │   │      │                     │        │
         Yes │   │ No   │                     │        │
             │   │      │                     │        │
      ┌──────▼┐  └──────┘                     │        │
      │Log    │                               │        │
      │Recovery                               │        │
      └───┬───┘                               │        │
          │                                   │        │
          │         ┌─────────────────────────┘        │
          │         │                                  │
          │         │  ┌───────────────────────────────┘
          │         │  │
          │  ┌──────▼──▼──┐
          │  │Continue    │
          │  │Processing  │
          │  └──────┬─────┘
          │         │
          └─────────┘
                    │
       ┌────────────▼─────────────┐
       │ Operation Complete       │
       └──────────────────────────┘


Configuration Error Path:
   ┌────────────────┐
   │Config Error    │
   └────────┬───────┘
            │
   ┌────────▼───────┐
   │Alert Team      │
   │Immediately     │
   └────────┬───────┘
            │
   ┌────────▼───────┐
   │Await Manual    │
   │Fix             │
   └────────┬───────┘
            │
            └──────> Continue Processing


Escalation Path (Attempt >= 3):
   ┌────────────────┐
   │Escalate to     │
   │Fallback        │
   └────────┬───────┘
            │
   ┌────────▼───────┐
   │Enter Fallback  │
   │Mode            │
   └────────┬───────┘
            │
   ┌────────▼───────┐
   │Send Basic      │
   │Notification    │
   └────────┬───────┘
            │
   ┌────────▼───────┐
   │Notify Eng.     │
   │Team            │
   └────────┬───────┘
            │
            └──────> Continue Processing
```

---

## Notification Delivery Pipeline

```
┌──────────────┐
│ Cron Trigger │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ Collect Data │
└──┬───────┬──┬┘
   │       │  │
   ▼       ▼  ▼
┌────┐ ┌────┐ ┌────────────┐
│Mail│ │DB  │ │AI Analysis │
│Jet │ │Data│ │Query       │
└─┬──┘ └─┬──┘ └─────┬──────┘
  │      │          │
  └──────┴────┬─────┘
              │
       ┌──────▼─────────┐
       │ Aggregate All  │
       │ Data           │
       └──────┬─────────┘
              │
       ┌──────▼─────────┐
       │ Format Message │
       └──────┬─────────┘
              │
       ┌──────▼─────────┐
       │ Build Block    │
       │ Kit JSON       │◄───────┐
       └──────┬─────────┘        │
              │                  │
       ┌──────▼─────────┐        │
       │ Validate       │        │
       │ Structure?     │        │
       └──┬──────────┬──┘        │
          │ Valid    │ Invalid   │
          │          │           │
          │     ┌────▼─────┐     │
          │     │Auto-Fix  │     │
          │     │Issues    ├─────┘
          │     └──────────┘
          │
   ┌──────▼─────────┐
   │ Send via       │
   │ Slack MCP      │
   └──────┬─────────┘
          │
   ┌──────▼─────────┐
   │ Delivered?     │
   └──┬──────────┬──┘
      │ Yes      │ No
      │          │
┌─────▼──────┐ ┌─▼──────────┐
│Record      │ │Record      │
│Success     │ │Failure     │
└─────┬──────┘ └─┬──────────┘
      │          │
      │       ┌──▼──────┐
      │       │Retry?   │
      │       └──┬───┬──┘
      │          │   │ No
      │      Yes │   │
      │          └───┼───────┐
      │              │       │
      │         ┌────▼────┐  │
      │         │Send to  │  │
      │         │Fallback │  │
      │         │Channel  │  │
      │         └────┬────┘  │
      │              │       │
      └──────────────┴───────┘
                     │
          ┌──────────▼─────────┐
          │ Update Database    │
          └──────────┬─────────┘
                     │
          ┌──────────▼─────────┐
          │ Complete           │
          └────────────────────┘
```

---

## Integration Points

```
┌─────────────────────────────────────────────────────────────────────┐
│                        CAMPAIGN MANAGER                             │
│                                                                     │
│  ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌──────────┐  │
│  │ Scheduler  │──>│ Lifecycle  │──>│  Metrics   │──>│    AI    │  │
│  │ Service    │   │ Service    │   │  Service   │   │ Service  │  │
│  └────────────┘   └──────┬─────┘   └──────┬─────┘   └────┬─────┘  │
│                          │                │              │        │
└──────────────────────────┼────────────────┼──────────────┼────────┘
                           │                │              │
                           │                │              │
    ┌──────────────────────┘                │              │
    │                                       │              │
    │  ┌────────────────────────────────────┘              │
    │  │                                                   │
    │  │  ┌────────────────────────────────────────────────┘
    │  │  │
    ▼  ▼  ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         MAILJET PLATFORM                            │
│                                                                     │
│  ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌──────────┐  │
│  │ REST API   │   │  Contact   │   │  Campaign  │   │Statistics│  │
│  │    v3      │   │   Lists    │   │   Drafts   │   │   API    │  │
│  └────────────┘   └────────────┘   └────────────┘   └──────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────┐
│                    SLACK MANAGER (MCP)                              │
│                                                                     │
│  ┌────────────┐        ┌────────────┐        ┌──────────────────┐  │
│  │ MCP Server │───────>│send_message│───────>│ #_traction       │  │
│  │            │        │    Tool    │        │  Channel         │  │
│  └──────▲─────┘        └────────────┘        └──────────────────┘  │
│         │                                                           │
└─────────┼───────────────────────────────────────────────────────────┘
          │
          │ (from Lifecycle & Metrics Services)
          │


┌─────────────────────────────────────────────────────────────────────┐
│                        GOOGLE GEMINI                                │
│                                                                     │
│  ┌────────────┐        ┌────────────┐        ┌──────────────────┐  │
│  │Generative  │───────>│  Gemini    │───────>│   Multiple AI    │  │
│  │  AI API    │        │ 2.0 Flash  │        │    Agents        │  │
│  └──────▲─────┘        └────────────┘        └──────────────────┘  │
│         │                                                           │
└─────────┼───────────────────────────────────────────────────────────┘
          │
          │ (from AI Service)
          │


┌─────────────────────────────────────────────────────────────────────┐
│                          PostgreSQL                                 │
│                                                                     │
│                       ┌────────────┐                                │
│                       │  Tables    │                                │
│                       │            │                                │
│                       └──────▲─────┘                                │
│                              │                                      │
└──────────────────────────────┼──────────────────────────────────────┘
                               │
                               │ (from Lifecycle & Metrics Services)
                               │


Connection Summary:
  • Scheduler → Lifecycle → Metrics → AI (Internal Services)
  • Lifecycle → MailJet REST API v3
  • Metrics → MailJet Statistics API
  • AI → Google Gemini Generative AI API
  • Lifecycle & Metrics → Slack MCP Server → send_message → #_traction
  • Lifecycle & Metrics → PostgreSQL Tables
```

---

## References

- [00_brainstorm.md](./00_brainstorm.md) - Feature concept and brainstorm
- [02_architecture.md](./02_architecture.md) - Technical architecture
- [03_feature_specification.md](./03_feature_specification.md) - Complete feature specification
- [../01_workflow.md](../01_workflow.md) - Core system workflow documentation

---

**Last Updated**: October 1, 2025
**Version**: 1.0
**Status**: ✅ Complete
